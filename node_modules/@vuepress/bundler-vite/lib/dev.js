"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.dev = void 0;
const utils_1 = require("@vuepress/utils");
const vite_1 = require("vite");
const resolveViteConfig_1 = require("./resolveViteConfig");
const dev = async (options, app) => {
    // plugin hook: extendsBundlerOptions
    await app.pluginApi.hooks.extendsBundlerOptions.process(options, app);
    const viteConfig = await (0, resolveViteConfig_1.resolveViteConfig)({
        app,
        options,
        isBuild: false,
        isServer: false,
    });
    const server = await (0, vite_1.createServer)(viteConfig);
    await server.listen();
    server.config.logger.info(utils_1.chalk.cyan(`\n  vite v${require('vite/package.json').version}`) +
        utils_1.chalk.green(` dev server running at:\n`), {
        clear: !server.config.logger.hasWarned,
    });
    server.printUrls();
    return server.close.bind(server);
};
exports.dev = dev;
